<!-- templates/weakness.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Weakness — Pokédex</title>

  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='weakness.css') }}">
</head>
<body>
  <header class="wk-header">
    <a class="wk-home" href="{{ url_for('index') }}">← Home</a>
    <h1 class="wk-title">Weakness Checker</h1>
  </header>

  <main class="wk-main container">
    <section class="wk-search">
      <form action="{{ url_for('weakness') }}" method="get" class="wk-form">
        <input name="name" type="text" placeholder="Enter Pokémon name (e.g. charizard)" value="{{ name or '' }}" required>
        <button type="submit">Check</button>
      </form>
    </section>

    {% if not result and name %}
      <div class="wk-empty">No weakness data found for <strong>{{ name }}</strong>. Try another name.</div>
    {% endif %}

    {% if result %}
      {# Top summary: Pokémon name + types #}
      <section class="wk-summary">
        <div class="wk-left">
          <h2 class="poke-name">{{ name | capitalize }}</h2>
          {% if result.types %}
            <div class="type-list">
              {% for t in result.types %}
                <span class="type-chip type-{{ t|lower }}">{{ t }}</span>
              {% endfor %}
            </div>
          {% endif %}
        </div>

        <div class="wk-actions">
          <button id="filter-strong" class="filter-btn">Show strong (×2)</button>
          <button id="filter-all" class="filter-btn active">Show all</button>
        </div>
      </section>

      {# Weakness list (sorted descending by multiplier) #}
      <section class="wk-weaknesses">
        <h3>Weaknesses</h3>
        {% set weaknesses = result.weaknesses if result.weaknesses is defined else [] %}
        {% if weaknesses %}
          {% set sorted = weaknesses|sort(attribute='multiplier', reverse=true) %}
          <div class="weak-grid">
            {% for w in sorted %}
              <article class="weak-card" data-mult="{{ w.multiplier }}">
                <div class="weak-left">
                  <span class="type-chip type-{{ w.type|lower }}">{{ w.type }}</span>
                  <div class="mult">×{{ (w.multiplier|string).rstrip('0').rstrip('.') }}</div>
                </div>
                <div class="weak-bar-wrap" aria-hidden="true">
                  <div class="weak-bar" style="--target: {{ (w.multiplier / 2) * 100 }}%"></div>
                </div>
                <div class="weak-desc">
                  {% if w.note %}{{ w.note }}{% else %}Increased damage from {{ w.type }} moves.{% endif %}
                </div>
              </article>
            {% endfor %}
          </div>
        {% else %}
          <div class="wk-empty">No weakness entries in API response.</div>
        {% endif %}
      </section>

      {# Recommended counters (optional) #}
      {% if result.recommended %}
      <section class="wk-counters">
        <h3>Recommended counters</h3>
        <div class="counters-grid">
          {% for p in result.recommended %}
            <div class="counter-card">
              <img src="{{ p.sprite if p.sprite is defined else url_for('static', filename='placeholder.png') }}" alt="{{ p.name }}">
              <div class="counter-name">{{ p.name }}</div>
              {% if p.reason %}
                <div class="counter-reason">{{ p.reason }}</div>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      </section>
      {% endif %}
    {% endif %}
  </main>

  <script src="{{ url_for('static', filename='weakness.js') }}"></script>
</body>
</html>
